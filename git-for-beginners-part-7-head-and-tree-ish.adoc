== Git для начинающих. Часть 7. Поговорим о HEAD и tree-ish

В этой статье мы коснемся двух понятий git, знание и
понимание смысла которых позволит вам более эффективно работать с этой системой контроля версий.

* <<anchor-1,_HEAD_>>
* <<anchor-2,_Tree-is_>>

=== _HEAD_ [[anchor-1]]

Начнем с _HEAD_. _HEAD_ – это указатель,
задача которого ссылаться на определенный коммит в репозитории.
Суть данного указателя можно попытаться объяснить с разных сторон.

*Во-первых*, _HEAD_ – это указатель на коммит в вашем репозитории,
который станет родителем следующего коммита.
Для того, чтобы лучше понять это, обратимся к репозиторию,
созданному в рамках link:https://devpractice.ru/git-for-beginners-part-6-git-log-work/[предыдущей статьи], в этом репозитории сделано шесть коммитов, посмотрим на них.
[source, sh]
> git log --oneline
cf3d9d8 [add] ignore .tmp files
a7b88ee [create]: git ignore file
c185b80 [create]: header for main
2b826bb [create]: main file of programm
bc067c8 [add]: caption into README file
a98cce4 [create repository]

Эти коммиты создавались в порядке от самого нижнего _(a98cce4)_ к самому верхнему _(cf3d9d8)_.
Каждый раз, когда мы отправляли новый коммит в репозиторий, _HEAD_ смещался и указывал на него.
Посмотрите на картинку ниже: на ней показана ситуация, когда были отправлены три первых коммита.

image::/img/git-head-pic1.png[]

После того как вы отправили коммит с _id = 2b826bb_, указатель _HEAD_ стал показывать на него,
т.е. данный коммит будет родителем для следующего,
и когда мы сделаем еще один коммит, _HEAD_ сместится.

image::/img/git-head-pic2.png[]

*Во-вторых*, _HEAD_ указывает на коммит, относительного которого будет создана рабочая копия во-время операции _checkout_.
Другими словами, когда вы переключаетесь с ветки на ветку
(о ветвлении в _git_ будет рассказано в одной из ближайших статей), и
спользуя операцию checkout, то в вашем репозитории указатель
_HEAD_ будет переключаться между последними коммитами выбираемых вами ветвей.

В нашем репозитории пока только одна ветвь – _master_, но и этого будет достаточно,
чтобы показать зависимость между положением указателя _HEAD_ и операцией _checkout_.

Текущее состояние репозитория выглядит так, как показано на рисунке ниже.

image::/img/git-head-pic3.png[]

Для того, чтобы скопировать снимок репозитория относительно последнего коммита ветки _master_,
т.е. того на который указывает _HEAD_, необходимо выполнить следующую команду.

[source, sh]
> git checkout master
Switched to branch 'master'

Содержимое репозитория, в данном случае, выглядит так.

[source, sh]
> git log --oneline
cf3d9d8 [add] ignore .tmp files
a7b88ee [create]: git ignore file
c185b80 [create]: header for main
2b826bb [create]: main file of programm
bc067c8 [add]: caption into README file
a98cce4 [create repository]

Теперь передвинем указатель _HEAD_ на коммит с _id=2b826bb_.

image::/img/git-head-pic4.png[]

Для этого передадим команде _checkout_ идентификатор коммита.
[source, sh]
----
> git checkout 2b826bb
Note: checking out '2b826bb'.

You are in 'detached HEAD' state. You can look around, make experimental
changes and commit them, and you can discard any commits you make in this
state without impacting any branches by performing another checkout.

If you want to create a new branch to retain commits you create, you may
do so (now or later) by using -b with the checkout command again. Example:

  git checkout -b <new-branch-name>

HEAD is now at 2b826bb... [create]: main file of programm
----
Обратите внимание на текст, который напечатал _git_, после того, как была выполнена эта команда.
Нас интересует самая последняя строка _“HEAD is now at 2b826bb…”_,
теперь _HEAD_ указывает на коммит с _id=2b826bb_ – именно то, что мы хотели.
Посмотрим на текущий список коммитов.

[source, sh]
> git log --oneline
2b826bb [create]: main file of programm
bc067c8 [add]: caption into README file
a98cce4 [create repository]

_Git_ выводит коммиты, которые были сделаны до того коммита,
на который ссылается _HEAD_.

Вернем _HEAD_ на прежнее место.
[source, sh]
----
> git checkout cf3d9d8
Previous HEAD position was 2b826bb... [create]: main file of programm
HEAD is now at cf3d9d8... [add] ignore .tmp files

> git log --oneline
cf3d9d8 [add] ignore .tmp files
a7b88ee [create]: git ignore file
c185b80 [create]: header for main
2b826bb [create]: main file of programm
bc067c8 [add]: caption into README file
a98cce4 [create repository]
----
Все вернулось на прежнее место. Таким образом, вы можете получать в виде рабочей копии
содержимое репозитория на момент отправки того или иного коммита.
Перейдем в каталог ._git_, в котором находится наш репозиторий, он расположен в корневой директории
нашего проекта, и посмотрим его содержимое.

[source, sh]
> cd .git
> ls -la
total 21
drwxr-xr-x 1 User 197121   0 мар 18 17:10 ./
drwxr-xr-x 1 User 197121   0 мар 18 17:10 ../
-rw-r--r-- 1 User 197121  24 мар  5 23:21 COMMIT_EDITMSG
-rw-r--r-- 1 User 197121 184 мар  5 23:10 config
-rw-r--r-- 1 User 197121  73 мар  5 23:10 description
-rw-r--r-- 1 User 197121  41 мар 18 17:10 HEAD
drwxr-xr-x 1 User 197121   0 мар  5 23:10 hooks/
-rw-r--r-- 1 User 197121 441 мар 18 17:10 index
drwxr-xr-x 1 User 197121   0 мар  5 23:10 info/
drwxr-xr-x 1 User 197121   0 мар  5 23:10 logs/
drwxr-xr-x 1 User 197121   0 мар  5 23:21 objects/
drwxr-xr-x 1 User 197121   0 мар  5 23:10 refs/

В данном каталоге содержится файл _HEAD_, в нем находится идентификатор, на который ссылается данный указатель.
Посмотрим содержимое файла _HEAD_.

[source, sh]
> cat HEAD
cf3d9d8f7b283267a085986e85cc8f152cca420d

_HEAD_ указывает на коммит _cf3d9d8_.

=== Tree-ish [[anchor-2]]

Понятие _tree-ish_ часто используется в документации по _git_.
_Tree-ish_ – это то, что указывает на коммит,
эту сущность мы можем передавать в качестве аргумента для команд _git_. Вот список того, чем может являться _tree-ish_.

[source, sh]
 ----------------------------------------------------------------------
 |          Tree-ish         | Examples
 ----------------------------------------------------------------------
 |  1. <sha1>                | dae86e1950b1277e545cee180551750029cfe735
 |  2. <describeOutput>      | v1.7.4.2-679-g3bee7fb
 |  3. <refname>             | master, heads/master, refs/heads/master
 |  4. <refname>@{<date>}    | master@{yesterday}, HEAD@{5 minutes ago}
 |  5. <refname>@{<n>}       | master@{1}
 |  6. @{<n>}                | @{1}
 |  7. @{-<n>}               | @{-1}
 |  8. <refname>@{upstream}  | master@{upstream}, @{u}
 |  9. <rev>^                | HEAD^, v1.5.1^0
 | 10. <rev>~<n>             | master~3
 | 11. <rev>^{<type>}        | v0.99.8^{commit}
 | 12. <rev>^{}              | v0.99.8^{}
 | 13. <rev>^{/<text>}       | HEAD^{/fix nasty bug}
 | 14. :/<text>              | :/fix nasty bug
 | 15. <rev>:<path>          | HEAD:README.txt, master:sub-directory/
 ----------------------------------------------------------------------
 Рассмотрим работу с tree-ish на примере команды git show.

[source, sh]
----
> git show cf3d9d8f -q
commit cf3d9d8f7b283267a085986e85cc8f152cca420d
Author: Writer <writer@somecompany.com>
Date:   Mon Mar 5 23:21:59 2018 +0500

    [add] ignore .tmp files

> git show -q HEAD
commit cf3d9d8f7b283267a085986e85cc8f152cca420d
Author: Writer <writer@somecompany.com>
Date:   Mon Mar 5 23:21:59 2018 +0500

    [add] ignore .tmp files

> git show -q master
commit cf3d9d8f7b283267a085986e85cc8f152cca420d
Author: Writer <writer@somecompany.com>
Date:   Mon Mar 5 23:21:59 2018 +0500

    [add] ignore .tmp files

> git show -q @{5}
commit cf3d9d8f7b283267a085986e85cc8f152cca420d
Author: Writer <writer@somecompany.com>
Date:   Mon Mar 5 23:21:59 2018 +0500

    [add] ignore .tmp files
----
Во всех примерах, представленных выше, команде _git show_ мы передаем различные _tree-ish_, которые на самом деле указывают на одно и тоже место – последний коммит.